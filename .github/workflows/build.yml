name: Build
on:
  push:
    branches:
      - main
    paths:
      - Makefile
      - '**.elm'
      - elm.json
      - 'src/**.otf'
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Setup Elm
        uses: mpizenberg/elm-tooling-action@e8d4d23a71ba5993d67ca18531438991e3b4e28d
        with:
          cache-key: elm-home-${{ hashFiles('elm.json') }}
      - name: Install dependencies
        run: |
          pip install brotli fonttools
          npm install --location=global uglify-js
      - name: Build
        run: |
          rm app.js NikumaruFont.*.woff2 || true
          make app.js fonts
          git add -- app.js *.woff2 \*.woff2
      - uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: 'chore(ci): build'
          commit_author: github-actions[bot] <github-actions[bot]@users.noreply.github.com>
      - uses: benc-uk/workflow-dispatch@4c044c1613fabbe5250deadc65452d54c4ad4fc7
        with:
          workflow: 3609993
          repo: U-cauda-elongata/u-cauda-elongata.github.io
          ref: refs/heads/master
          token: ${{ secrets.PERSONAL_TOKEN }}
